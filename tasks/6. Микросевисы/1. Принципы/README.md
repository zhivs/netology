
# Домашнее задание к занятию «Микросервисы: принципы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

## Задача 1: API Gateway 

Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

Решение должно соответствовать следующим требованиям:
- маршрутизация запросов к нужному сервису на основе конфигурации,
- возможность проверки аутентификационной информации в запросах,
- обеспечение терминации HTTPS.

Обоснуйте свой выбор.

| Решение              | Маршрутизация | Аутентификация | HTTPS-терминация | Простота настройки | Расширяемость | Производительность | Поддержка плагинов |
|----------------------|---------------|----------------|------------------|--------------------|---------------|--------------------|---------------------|
| **Kong**             | Отлично: гибкие маршруты, поддержка REST, GraphQL, gRPC, WebSocket | Отлично: OAuth2, JWT, OIDC, Basic Auth, HMAC | Да, автоматическое управление TLS | Средняя: требует настройки через CLI или REST API, но есть GUI (Kong Manager) | Отлично: Lua-плагины, Kong Plugin Hub, поддержка кастомных плагинов | Высокая: основан на Nginx, обрабатывает миллионы запросов/с | Отлично: обширная экосистема плагинов, поддержка кастомизации |
| **Apache APISIX**    | Отлично: динамическая маршрутизация, поддержка REST, gRPC, WebSocket | Отлично: OAuth2, JWT, Key Auth, OpenID | Да, поддержка TLS и mTLS | Высокая: интуитивный dashboard, YAML-конфигурации | Отлично: Lua-плагины, интеграция с etcd | Очень высокая: до 1 трлн запросов/день, низкая латентность благодаря OpenResty | Отлично: множество встроенных плагинов, поддержка кастомных |
| **Tyk**              | Отлично: маршрутизация по URL, поддержка GraphQL, REST, gRPC | Отлично: OAuth2, JWT, OIDC, токены | Да, полная поддержка TLS | Высокая: удобный dashboard, быстрая настройка | Хорошая: плагины на Go, JavaScript, Lua | Высокая: основан на Go, оптимизирован для высоких нагрузок | Хорошая: поддержка плагинов, но менее гибкая, чем Kong/APISIX |
| **KrakenD**          | Отлично: маршрутизация с агрегацией данных, поддержка REST, GraphQL | Хорошая: OAuth, JWT, но ограничен без плагинов | Да, поддержка TLS | Очень высокая: JSON/YAML-конфигурации, KrakenDesigner GUI | Средняя: ограниченная плагинная модель, встроенные скрипты | Очень высокая: до 70,000 запросов/с, stateless-архитектура | Средняя: ограниченные плагины, поддержка асинхронных агентов |
| **AWS API Gateway**  | Отлично: маршрутизация к AWS-сервисам (Lambda, Kinesis), REST, WebSocket | Отлично: IAM, Cognito, Lambda-авторизация, JWT | Да, встроенная поддержка TLS | Средняя: удобный UI, но сложная модель ценообразования | Средняя: ограничена AWS-экосистемой, нет кастомных плагинов | Высокая: масштабируемость в AWS, но возможны ограничения по таймаутам (30с) | Отсутствует: нет поддержки кастомных плагинов |
| **Azure API Management** | Отлично: маршрутизация, поддержка REST, GraphQL | Отлично: OAuth2, JWT, Azure AD | Да, полная поддержка TLS | Средняя: интуитивный UI, но требует интеграции с Azure | Средняя: ограничена Azure-экосистемой | Высокая: масштабируемость в Azure | Отсутствует: встроенные функции, но без кастомных плагинов |
| **NGINX (с модулем API Gateway)** | Хорошая: базовая маршрутизация, требует доп. конфигурации | Хорошая: JWT, OAuth с модулями | Да, отличная поддержка TLS | Низкая: требует ручной настройки конфигураций | Хорошая: Lua-модули, но сложнее, чем Kong/APISIX | Очень высокая: лидер по производительности | Средняя: ограниченные модули, сложная разработка |

## Примечания
- **Kong**: Популярное open-source решение с мощной экосистемой плагинов и интеграцией с Kubernetes. Подходит для гибридных и мультиоблачных сред.[](https://nordicapis.com/top-10-api-gateways-in-2025/)
- **Apache APISIX**: Высокопроизводительный open-source gateway с акцентом на динамическую маршрутизацию и интеграцию с Prometheus/Grafana.[](https://gateway-api.sigs.k8s.io/implementations/)
- **Tyk**: Open-source с коммерческой поддержкой, удобный интерфейс, но меньшая гибкость плагинов.[](https://www.moesif.com/blog/technical/api-gateways/How-to-Choose-The-Right-API-Gateway-For-Your-Platform-Comparison-Of-Kong-Tyk-Apigee-And-Alternatives/)
- **KrakenD**: Легковесное open-source решение, оптимизированное для производительности и простоты, но ограничено в кастомизации.[](https://www.moesif.com/blog/technical/api-gateways/How-to-Choose-The-Right-API-Gateway-For-Your-Platform-Comparison-Of-Kong-Tyk-Apigee-And-Alternatives/)
- **AWS API Gateway**: Проприетарное решение, идеально для AWS-экосистемы, но с риском vendor lock-in и сложной ценовой моделью.[](https://www.peerspot.com/products/amazon-api-gateway-reviews)
- **Azure API Management**: Проприетарное решение для Azure, мощное, но ограничено экосистемой Microsoft.[](https://expertinsights.com/devops/the-top-api-gateways)
- **NGINX**: Не полноценный API Gateway, но может быть настроен для базовых задач. Требует значительных усилий для кастомизации.[](https://www.f5.com/glossary/api-gateway)



## Задача 2: Брокер сообщений

Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

Решение должно соответствовать следующим требованиям:
- поддержка кластеризации для обеспечения надёжности,
- хранение сообщений на диске в процессе доставки,
- высокая скорость работы,
- поддержка различных форматов сообщений,
- разделение прав доступа к различным потокам сообщений,
- простота эксплуатации.

Обоснуйте свой выбор.

# Сравнительная таблица возможностей брокеров сообщений

| Брокер              | Кластеризация | Хранение на диске | Высокая скорость | Форматы сообщений | Разделение прав доступа | Простота эксплуатации |
|---------------------|---------------|-------------------|------------------|-------------------|-----------------------|-----------------------|
| **Apache Kafka**    | Отлично: распределённая архитектура, кластеризация через ZooKeeper или KRaft, высокая отказоустойчивость | Отлично: сообщения сохраняются на диске с настраиваемым сроком хранения, поддержка репликации | Очень высокая: миллионы сообщений/с, последовательный дисковый ввод-вывод | Отлично: поддержка JSON, XML, Avro, бинарные данные, произвольные форматы | Отлично: управление доступом через ACL, интеграция с Kerberos, SASL | Средняя: требует настройки ZooKeeper/KRaft, сложность в начальной конфигурации |[](https://aws.amazon.com/compare/the-difference-between-rabbitmq-and-kafka/)[](https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-messaging-overview)
| **RabbitMQ**        | Хорошая: поддержка кластеризации, репликация очередей между узлами | Хорошая: сообщения сохраняются на диске до доставки, но не для долгосрочного хранения | Средняя: тысячи сообщений/с, может замедляться при перегрузке очередей | Хорошая: JSON, XML, текст, бинарные данные, поддержка AMQP, MQTT, STOMP | Отлично: детализированное управление доступом через роли и политики | Высокая: удобный веб-интерфейс, простая настройка через UI |[](https://aws.amazon.com/compare/the-difference-between-rabbitmq-and-kafka/)[](https://aws.amazon.com/compare/the-difference-between-rabbitmq-and-kafka/)[](https://geekflare.com/dev/top-message-brokers/)
| **Apache ActiveMQ** | Хорошая: поддержка кластеризации через shared storage или LevelDB, но ограничения в масштабируемости | Хорошая: поддержка хранения на диске, настраиваемая персистентность | Средняя: до 20,000 сообщений/с, зависит от конфигурации | Хорошая: JSON, XML, бинарные данные, поддержка AMQP, MQTT, OpenWire, STOMP | Хорошая: управление доступом через плагины, но менее гибкое, чем Kafka/RabbitMQ | Средняя: требует ручной настройки конфигураций, есть веб-интерфейс |[](https://dzone.com/articles/exploring-message-brokers)[](https://estafet.com/simple-guide-to-message-brokers/)[](https://dzone.com/articles/exploring-message-brokers)
| **Redis**           | Средняя: кластеризация через Redis Cluster, но не предназначен для долгосрочной отказоустойчивости | Слабая: в основном in-memory, опциональное сохранение на диск (AOF/RDB), риск потери данных | Очень высокая: сотни тысяч сообщений/с, но с компромиссом по надежности | Хорошая: текст, JSON, бинарные данные, но без строгой структуры | Средняя: базовые ACL, менее детализированные, чем у Kafka/RabbitMQ | Высокая: простая установка и настройка, минималистичная конфигурация |[](https://en.wikipedia.org/wiki/Message_broker)[](https://geekflare.com/dev/top-message-brokers/)[](https://www.dragonflydb.io/guides/message-queues)
| **Amazon SQS**      | Отлично: полностью управляемая кластеризация, высокая доступность через AWS | Хорошая: сообщения хранятся до обработки, но не для долгосрочного хранения | Высокая: масштабируемость через AWS, но ограничения по пропускной способности | Хорошая: JSON, XML, текст, бинарные данные | Отлично: интеграция с AWS IAM для детализированного управления доступом | Очень высокая: полностью управляемый сервис, минимальная настройка |[](https://www.infoq.com/articles/choosing-message-broker/)[](https://learn.microsoft.com/en-us/azure/service-bus-messaging/service-bus-messaging-overview)[](https://www.infoq.com/articles/choosing-message-broker/)

## Примечания
- **Apache Kafka**: Идеален для высоконагруженных систем и потоковой обработки данных. Подходит для сценариев с долгосрочным хранением сообщений и аналитикой.[](https://www.confluent.io/learn/message-broker/)
- **RabbitMQ**: Универсальный брокер, хорошо подходящий для очередей задач и микросервисов, с акцентом на надёжную доставку сообщений.[](https://www.alibabacloud.com/tech-news/a/message_queue/gugz0vw2oh-message-brokers-revealed-kafka-vs-rabbitmq-vs-activemq)
- **Apache ActiveMQ**: Надёжный выбор для корпоративных приложений, но менее масштабируем, чем Kafka. Поддерживает множество протоколов.[](https://estafet.com/simple-guide-to-message-brokers/)
- **Redis**: Оптимизирован для высокой скорости, но не подходит для сценариев, требующих гарантированной сохранности данных.[](https://en.wikipedia.org/wiki/Message_broker)
- **Amazon SQS**: Полностью управляемое решение, идеально для AWS-экосистемы, но может быть ограничено по гибкости и стоимости.[](https://www.infoq.com/articles/choosing-message-broker/)
